# Reverse Proxy Config
http:
  use_x_forwarded_for: true
  trusted_proxies:
    - 10.0.0.1

# Loads default set of integrations. Do not remove.
default_config:

# Load frontend themes from the themes folder
frontend:
  themes: !include_dir_merge_named themes

automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

# Light Groups
light:
  - platform: group
    name: "Büro LEDs"
    unique_id: buero_leds_group
    all: false
    entities:
      - light.h619a
      - light.wled_4
      - light.h6061
      - light.wled_3


# Heizung Temperatur-Einstellungen
input_number:
  # Individuelle Thermostat-Einstellungen
  heizung_buero_tag_temperatur:
    name: "Büro Tagestemperatur"
    min: 16
    max: 25
    step: 0.5
    unit_of_measurement: "°C"
    icon: mdi:thermometer
  heizung_buero_nacht_temperatur:
    name: "Büro Nachttemperatur"
    min: 14
    max: 20
    step: 0.5
    unit_of_measurement: "°C"
    icon: mdi:thermometer-low
  heizung_bad_tag_temperatur:
    name: "Bad Tagestemperatur"
    min: 16
    max: 25
    step: 0.5
    unit_of_measurement: "°C"
    icon: mdi:thermometer
  heizung_bad_nacht_temperatur:
    name: "Bad Nachttemperatur"
    min: 14
    max: 20
    step: 0.5
    unit_of_measurement: "°C"
    icon: mdi:thermometer-low
  heizung_waschraum_tag_temperatur:
    name: "Waschraum Tagestemperatur"
    min: 16
    max: 25
    step: 0.5
    unit_of_measurement: "°C"
    icon: mdi:thermometer
  heizung_waschraum_nacht_temperatur:
    name: "Waschraum Nachttemperatur"
    min: 14
    max: 20
    step: 0.5
    unit_of_measurement: "°C"
    icon: mdi:thermometer-low
  heizung_kueche_tag_temperatur:
    name: "Küche Tagestemperatur"
    min: 16
    max: 25
    step: 0.5
    unit_of_measurement: "°C"
    icon: mdi:thermometer
  heizung_kueche_nacht_temperatur:
    name: "Küche Nachttemperatur"
    min: 14
    max: 20
    step: 0.5
    unit_of_measurement: "°C"
    icon: mdi:thermometer-low
  heizung_sauna_tag_temperatur:
    name: "Sauna Tagestemperatur"
    min: 16
    max: 25
    step: 0.5
    unit_of_measurement: "°C"
    icon: mdi:thermometer
  heizung_sauna_nacht_temperatur:
    name: "Sauna Nachttemperatur"
    min: 14
    max: 20
    step: 0.5
    unit_of_measurement: "°C"
    icon: mdi:thermometer-low
  # Globale Einstellungen für alle Thermostate
  heizung_alle_tag_temperatur:
    name: "Alle Tagestemperatur"
    min: 16
    max: 25
    step: 0.5
    unit_of_measurement: "°C"
    icon: mdi:home-thermometer
  heizung_alle_nacht_temperatur:
    name: "Alle Nachttemperatur"
    min: 14
    max: 20
    step: 0.5
    unit_of_measurement: "°C"
    icon: mdi:home-thermometer-outline

# Graph Toggle Helfer
input_boolean:
  heizung_buero_graph:
    name: "Büro Temperaturverlauf anzeigen"
    icon: mdi:chart-line
  heizung_bad_graph:
    name: "Bad Temperaturverlauf anzeigen"
    icon: mdi:chart-line
  heizung_waschraum_graph:
    name: "Waschraum Temperaturverlauf anzeigen"
    icon: mdi:chart-line
  heizung_kueche_graph:
    name: "Küche Temperaturverlauf anzeigen"
    icon: mdi:chart-line
  heizung_sauna_graph:
    name: "Sauna Temperaturverlauf anzeigen"
    icon: mdi:chart-line

# Fritzbox Connected Clients Counter
template:
  - sensor:
      - name: "Fritz Connected Clients"
        unique_id: fritz_connected_clients
        icon: mdi:devices
        state: >
          {{ states.device_tracker
             | selectattr('attributes.source_type', 'eq', 'router')
             | selectattr('state', 'eq', 'home')
             | list | count }}
      - name: "Fritz WLAN Clients"
        unique_id: fritz_wlan_clients
        icon: mdi:wifi
        state: >
          {{ states.device_tracker
             | selectattr('attributes.source_type', 'eq', 'router')
             | selectattr('state', 'eq', 'home')
             | selectattr('attributes.connection_type', 'defined')
             | selectattr('attributes.connection_type', 'eq', 'WLAN')
             | list | count }}
      - name: "Fritz Download Prozent"
        unique_id: fritz_download_percent
        unit_of_measurement: "%"
        state: >
          {% set current = states('sensor.fritz_box_7530_ax_download_durchsatz') | float(0) * 8 %}
          {% set max = states('sensor.fritz_box_7530_ax_maximaler_download_durchsatz_der_verbindung') | float(1) %}
          {{ ((current / max) * 100) | round(1) }}
      - name: "Fritz Upload Prozent"
        unique_id: fritz_upload_percent
        unit_of_measurement: "%"
        state: >
          {% set current = states('sensor.fritz_box_7530_ax_upload_durchsatz') | float(0) * 8 %}
          {% set max = states('sensor.fritz_box_7530_ax_maximaler_upload_durchsatz_der_verbindung') | float(1) %}
          {{ ((current / max) * 100) | round(1) }}

# Energie-Sensoren für Zigbee Steckdosen (berechnet aus Leistung)
sensor:
  - platform: integration
    source: sensor.steckdose_fred_power
    name: "Steckdose Fred Energie"
    unique_id: steckdose_fred_energy_calculated
    unit_prefix: k
    unit_time: h
    method: left
  - platform: integration
    source: sensor.steckdose_helene_power
    name: "Steckdose Helene Energie"
    unique_id: steckdose_helene_energy_calculated
    unit_prefix: k
    unit_time: h
    method: left
