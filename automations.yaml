- id: heizung_buero_tag
  alias: "Heizung Büro - Tagesmodus"
  description: "Büro auf eingestellte Tagestemperatur von 7:00 bis 22:00"
  trigger:
    - platform: time
      at: "07:00:00"
      id: time_trigger
    - platform: homeassistant
      event: start
      id: startup_trigger
    - platform: time_pattern
      minutes: "/5"
      id: retry_trigger
    - platform: state
      entity_id: input_number.heizung_buero_tag_temperatur
      id: temp_changed
  condition:
    - condition: time
      after: "07:00:00"
      before: "22:00:00"
  action:
    - service: climate.set_hvac_mode
      target:
        entity_id: climate.heizung_buro
      data:
        hvac_mode: auto
    - delay:
        milliseconds: 500
    - service: climate.set_temperature
      target:
        entity_id: climate.heizung_buro
      data:
        temperature: "{{ states('input_number.heizung_buero_tag_temperatur') | float }}"

- id: heizung_buero_nacht
  alias: "Heizung Büro - Nachtmodus"
  description: "Büro auf eingestellte Nachttemperatur ab 22:00"
  trigger:
    - platform: time
      at: "22:00:00"
      id: time_trigger
    - platform: homeassistant
      event: start
      id: startup_trigger
    - platform: time_pattern
      minutes: "/5"
      id: retry_trigger
    - platform: state
      entity_id: input_number.heizung_buero_nacht_temperatur
      id: temp_changed
  condition:
    - condition: or
      conditions:
        - condition: time
          after: "22:00:00"
        - condition: time
          before: "07:00:00"
  action:
    - service: climate.set_hvac_mode
      target:
        entity_id: climate.heizung_buro
      data:
        hvac_mode: auto
    - delay:
        milliseconds: 500
    - service: climate.set_temperature
      target:
        entity_id: climate.heizung_buro
      data:
        temperature: "{{ states('input_number.heizung_buero_nacht_temperatur') | float }}"

- id: heizung_bad_tag
  alias: "Heizung Bad - Tagesmodus"
  description: "Bad auf eingestellte Tagestemperatur von 7:00 bis 22:00"
  trigger:
    - platform: time
      at: "07:00:00"
      id: time_trigger
    - platform: homeassistant
      event: start
      id: startup_trigger
    - platform: time_pattern
      minutes: "/5"
      id: retry_trigger
    - platform: state
      entity_id: input_number.heizung_bad_tag_temperatur
      id: temp_changed
  condition:
    - condition: time
      after: "07:00:00"
      before: "22:00:00"
  action:
    - service: climate.set_hvac_mode
      target:
        entity_id: climate.heizung_bad
      data:
        hvac_mode: auto
    - delay:
        milliseconds: 500
    - service: climate.set_temperature
      target:
        entity_id: climate.heizung_bad
      data:
        temperature: "{{ states('input_number.heizung_bad_tag_temperatur') | float }}"

- id: heizung_bad_nacht
  alias: "Heizung Bad - Nachtmodus"
  description: "Bad auf eingestellte Nachttemperatur ab 22:00"
  trigger:
    - platform: time
      at: "22:00:00"
      id: time_trigger
    - platform: homeassistant
      event: start
      id: startup_trigger
    - platform: time_pattern
      minutes: "/5"
      id: retry_trigger
    - platform: state
      entity_id: input_number.heizung_bad_nacht_temperatur
      id: temp_changed
  condition:
    - condition: or
      conditions:
        - condition: time
          after: "22:00:00"
        - condition: time
          before: "07:00:00"
  action:
    - service: climate.set_hvac_mode
      target:
        entity_id: climate.heizung_bad
      data:
        hvac_mode: auto
    - delay:
        milliseconds: 500
    - service: climate.set_temperature
      target:
        entity_id: climate.heizung_bad
      data:
        temperature: "{{ states('input_number.heizung_bad_nacht_temperatur') | float }}"

# Globale Temperatur-Synchronisation
- id: heizung_alle_tag_sync
  alias: "Heizung Alle - Tag Temperatur Sync"
  description: "Synchronisiert die globale Tagestemperatur auf alle Thermostate"
  trigger:
    - platform: state
      entity_id: input_number.heizung_alle_tag_temperatur
  action:
    - service: input_number.set_value
      target:
        entity_id:
          - input_number.heizung_buero_tag_temperatur
          - input_number.heizung_bad_tag_temperatur
      data:
        value: "{{ states('input_number.heizung_alle_tag_temperatur') | float }}"

- id: heizung_alle_nacht_sync
  alias: "Heizung Alle - Nacht Temperatur Sync"
  description: "Synchronisiert die globale Nachttemperatur auf alle Thermostate"
  trigger:
    - platform: state
      entity_id: input_number.heizung_alle_nacht_temperatur
  action:
    - service: input_number.set_value
      target:
        entity_id:
          - input_number.heizung_buero_nacht_temperatur
          - input_number.heizung_bad_nacht_temperatur
      data:
        value: "{{ states('input_number.heizung_alle_nacht_temperatur') | float }}"


- id: 'fritz_auto_reload'
  alias: 'Fritz!Box Integration Auto-Reload'
  description: 'Lädt die Fritz!Box Integration automatisch neu wenn die Verbindung verloren geht'
  trigger:
    - platform: homeassistant
      event: start
    - platform: time_pattern
      minutes: "/5"
    - platform: state
      entity_id: binary_sensor.fritz_box_7530_ax_verbindung
      to: "unavailable"
      for:
        minutes: 2
  condition:
    - condition: state
      entity_id: binary_sensor.fritz_box_7530_ax_verbindung
      state: "unavailable"
  action:
    - delay:
        seconds: 30
    - service: homeassistant.reload_config_entry
      data:
        entry_id: 01KDD3ZC8W9XFFCHHDTW5VDSZ7
    - service: homeassistant.reload_config_entry
      data:
        entry_id: 01K9FVBT4VJMV74CVE6YGQ1S8J
    - service: persistent_notification.create
      data:
        title: 'Fritz!Box Integration'
        message: 'Fritz!Box Integration wurde automatisch neu geladen wegen Verbindungsverlust'
  mode: single
